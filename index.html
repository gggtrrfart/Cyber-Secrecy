<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cyber Secrecy</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
  <style>
    body {
      margin: 0;
      font-family: 'JetBrains Mono', monospace;
      background-color: #0b0f12;
      color: #00ff00;
      overflow: hidden;
    }

    #app {
      display: flex;
      height: 100vh;
      flex-direction: column;
    }

    header {
      background: #081014;
      padding: 10px;
      text-align: center;
      font-size: 1.5em;
      border-bottom: 2px solid #00ff00;
      color: #00ff00;
    }

    nav {
      display: flex;
      background-color: #0d1419;
      border-bottom: 1px solid #00ff00;
    }

    nav button {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: #00ff00;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.2s;
    }

    nav button:hover,
    nav button.active {
      background-color: #1a282f;
    }

    #content {
      flex: 1;
      position: relative;
    }

    .tab {
      display: none;
      height: 100%;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }

    .tab.active {
      display: block;
    }

    #terminal {
      height: 100%;
    }

    .chatbox {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      background-color: #101a1f;
      padding: 10px;
      font-size: 0.95em;
      line-height: 1.4;
    }

    .input-area {
      display: flex;
      border-top: 1px solid #00ff00;
    }

    .input-area input {
      flex: 1;
      background: #000;
      color: #0f0;
      padding: 8px;
      border: none;
      font-family: inherit;
    }

    .input-area button {
      padding: 8px 12px;
      background-color: #001f00;
      color: #0f0;
      border: none;
      cursor: pointer;
    }

    .server-entry {
      background: #111;
      margin: 6px 0;
      padding: 8px;
      border: 1px solid #0f0;
      cursor: pointer;
    }

    .editor-box {
      width: 100%;
      height: 70%;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      font-family: monospace;
      padding: 10px;
      box-sizing: border-box;
    }

    .market-box input {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
      background: #000;
      border: 1px solid #00ff00;
      color: #00ff00;
    }

    .market-box button {
      margin-top: 8px;
      padding: 8px;
      background: #001f00;
      color: #0f0;
      border: none;
      cursor: pointer;
    }

    #tutorial-popup {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #001010;
      color: #00ff00;
      padding: 20px;
      border: 2px solid #00ff00;
      z-index: 1000;
      text-align: center;
    }

    #tutorial-popup button {
      margin: 10px;
      padding: 6px 14px;
      background: #002800;
      color: #00ff00;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>Cyber Secrecy OS</header>
    <nav>
      <button class="tab-btn active" data-tab="terminal-tab">Terminal</button>
      <button class="tab-btn" data-tab="servers-tab">Servers</button>
      <button class="tab-btn" data-tab="editor-tab">Editor</button>
      <button class="tab-btn" data-tab="phone-tab">Phone</button>
      <button class="tab-btn" data-tab="market-tab">Black Market</button>
    </nav>
    <div id="content">
      <div id="terminal-tab" class="tab active">
        <div id="terminal"></div>
      </div>
      <div id="servers-tab" class="tab">
        <div id="servers-list"></div>
        <button onclick="reloadServers()">Reload</button>
      </div>
      <div id="editor-tab" class="tab">
        <textarea id="editor-code" class="editor-box">// Write malware here</textarea>
        <button onclick="saveEditor()">Save</button>
      </div>
      <div id="phone-tab" class="tab">
        <div class="chatbox">
          <div class="messages" id="chat-log"></div>
          <div class="input-area">
            <input type="text" id="chat-input" placeholder="Type message..." />
            <button onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
      <div id="market-tab" class="tab">
        <div class="market-box">
          <input id="market-data" placeholder="Enter data to sell..." />
          <button onclick="sellData()">Sell Data</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tutorial Prompt -->
  <div id="tutorial-popup" style="display: none;">
    <p>Welcome to Cyber Secrecy.<br>Would you like to start the tutorial?</p>
    <button onclick="startTutorial()">Yes</button>
    <button onclick="skipTutorial()">Skip</button>
  </div>

  <!-- External libs -->
  <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
<script>
  const term = new Terminal({
    cursorBlink: true,
    fontSize: 16,
    fontFamily: '"JetBrains Mono", monospace',
    theme: {
      background: '#0a0a0a',
      foreground: '#00ff00',
      cursor: '#00ff00',
      selectionBackground: 'rgba(0, 255, 0, 0.3)'
    }
  });

  let commandBuffer = '';
  let commandHistory = [];
  let historyIndex = 0;
  const PROMPT = '>| ';
  let malwareScripts = {};
  let currentChat = "Spectre";
  let chatHistory = [];

  // === Tutorial ===
  const tutorialPopup = document.getElementById("tutorial-popup");
  window.addEventListener('load', () => {
    tutorialPopup.style.display = 'block';
  });

  function startTutorial() {
    tutorialPopup.style.display = 'none';
    print("Tutorial starting...");
    print("Type 'help' to see available commands.");
  }

  function skipTutorial() {
    tutorialPopup.style.display = 'none';
    print("You skipped the tutorial. Type 'help' if you need assistance.");
  }

  // === Terminal ===
  term.open(document.getElementById('terminal'));
  function print(text = '') {
    term.writeln(text);
  }

  function prompt() {
    term.write('\r\n' + PROMPT);
  }

  function clearTerminal() {
    term.clear();
  }

  function handleCommand(cmd) {
    const parts = cmd.trim().split(' ');
    const base = parts[0];
    const arg = parts.slice(1).join(' ');

    switch (base) {
      case 'help':
        print("Available commands: clear, run <script>, ls");
        break;
      case 'clear':
        clearTerminal();
        break;
      case 'ls':
        print(Object.keys(malwareScripts).join('  ') || "(no scripts)");
        break;
      case 'run':
        if (!arg) {
          print("Usage: run <script>");
        } else if (!(arg in malwareScripts)) {
          print("No such script.");
        } else {
          print("Running " + arg + "...");
          print("Malware active on selected server.");
        }
        break;
      default:
        print("Unknown command.");
    }

    prompt();
  }

  term.onKey(e => {
    const ev = e.domEvent;
    const printable = !ev.altKey && !ev.ctrlKey && !ev.metaKey;

    if (ev.key === 'Enter') {
      term.write('\r\n');
      handleCommand(commandBuffer);
      if (commandBuffer.trim()) commandHistory.push(commandBuffer);
      historyIndex = commandHistory.length;
      commandBuffer = '';
    } else if (ev.key === 'Backspace') {
      if (commandBuffer.length > 0) {
        commandBuffer = commandBuffer.slice(0, -1);
        term.write('\b \b');
      }
    } else if (ev.key === 'ArrowUp') {
      if (historyIndex > 0) {
        historyIndex--;
        const prev = commandHistory[historyIndex];
        term.write('\r' + PROMPT + prev + ' '.repeat(commandBuffer.length - prev.length));
        commandBuffer = prev;
      }
    } else if (ev.key === 'ArrowDown') {
      if (historyIndex < commandHistory.length - 1) {
        historyIndex++;
        const next = commandHistory[historyIndex];
        term.write('\r' + PROMPT + next + ' '.repeat(commandBuffer.length - next.length));
        commandBuffer = next;
      }
    } else if (printable) {
      commandBuffer += ev.key;
      term.write(ev.key);
    }
  });

  print("Welcome");
  prompt();

  // === Tabs ===
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
      btn.classList.add('active');
    });
  });

  // === Servers ===
  const serversList = document.getElementById('servers-list');
  function genRandomServer() {
    const id = Math.floor(Math.random() * 1000);
    const rank = Math.floor(Math.random() * 10);
    const vuln = Math.random();
    const alert = Math.random();
    return {
      name: `AlphaCore-${id}`,
      rank,
      vulnerability: vuln,
      alertLevel: alert,
      hacked: false
    };
  }

  let servers = [];
  function reloadServers() {
    serversList.innerHTML = '';
    servers = Array.from({ length: 10 }, genRandomServer);
    servers.forEach((s, i) => {
      const el = document.createElement('div');
      el.className = 'server-entry';
      el.innerHTML = `
        <strong>${s.name}</strong><br/>
        Rank: ${s.rank}<br/>
        Vulnerability: ${(s.vulnerability * 100).toFixed(0)}%<br/>
        Alert Level: ${s.alertLevel < 0.33 ? 'Low' : s.alertLevel < 0.66 ? 'Medium' : 'High'}<br/>
        Status: ${s.hacked ? 'Hacked' : 'Secure'}
      `;
      el.onclick = () => {
        alert(`Viewing ${s.name}. Write and run a script to hack.`);
      };
      serversList.appendChild(el);
    });
  }
  reloadServers();

  // === Editor ===
  function saveEditor() {
    const code = document.getElementById("editor-code").value.trim();
    const filename = prompt("Save as script name (example: breach.js)");
    if (!filename) return;
    malwareScripts[filename] = code;
    alert("Saved script: " + filename);
  }

  // === Chat ===
  function sendMessage() {
    const input = document.getElementById("chat-input");
    const val = input.value.trim();
    if (!val) return;

    chatHistory.push({ sender: "You", text: val });
    addChatMessage("You", val);

    const response = getAIResponse(val);
    chatHistory.push({ sender: "Spectre", text: response });
    setTimeout(() => addChatMessage("Spectre", response), 500);
    input.value = '';
  }

  function addChatMessage(sender, text) {
    const log = document.getElementById("chat-log");
    const div = document.createElement("div");
    div.textContent = `${sender}: ${text}`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  function getAIResponse(input) {
    const lowered = input.toLowerCase();
    if (lowered.includes("hack")) return "You better not be messing with my servers.";
    if (lowered.includes("fbi")) return "Keep them off your trail.";
    if (lowered.includes("hi") || lowered.includes("hello")) return "Hey.";
    return "Roger that.";
  }

  // === Market ===
  function sellData() {
    const val = document.getElementById("market-data").value.trim();
    if (!val) return alert("No data entered.");
    const worth = Math.floor(Math.random() * 300) + 50;
    alert("Sold data for $" + worth);
    document.getElementById("market-data").value = '';
  }
</script>
</body>
</html>
